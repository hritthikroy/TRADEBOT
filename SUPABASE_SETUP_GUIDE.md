# üìä Supabase Database Setup Guide

## Overview

This guide will help you set up Supabase to store trading signals automatically.

## ‚úÖ What Gets Stored

Every trading signal generated by the bot is automatically saved to Supabase with:
- Signal details (BUY/SELL, symbol, strategy)
- Price levels (entry, stop loss, take profit)
- Trade metrics (risk/reward, profit/loss)
- Status tracking (ACTIVE, HIT_TP, HIT_SL)
- Progress monitoring
- Timestamps

## üöÄ Setup Steps

### Step 1: Create Supabase Account

1. Go to [https://supabase.com](https://supabase.com)
2. Click "Start your project"
3. Sign up with GitHub, Google, or Email
4. Create a new organization (free tier is fine)

### Step 2: Create a New Project

1. Click "New Project"
2. Fill in:
   - **Name**: Trading Bot Signals
   - **Database Password**: (create a strong password - save it!)
   - **Region**: Choose closest to you
   - **Pricing Plan**: Free (sufficient for most use cases)
3. Click "Create new project"
4. Wait 2-3 minutes for setup to complete

### Step 3: Get Your Credentials

1. In your project dashboard, click "Settings" (gear icon)
2. Click "API" in the left sidebar
3. Copy these values:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **anon public key**: Long string starting with `eyJ...`

### Step 4: Run the Database Schema

1. In Supabase dashboard, click "SQL Editor" in left sidebar
2. Click "New query"
3. Copy the entire content from `supabase-signals-schema.sql`
4. Paste it into the SQL editor
5. Click "Run" button
6. You should see "Success. No rows returned"

### Step 5: Configure Environment Variables

Edit `backend/.env` file:

```env
# Supabase Configuration
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_KEY=your-anon-key-here
```

Replace with your actual values from Step 3.

### Step 6: Restart Backend

```bash
cd backend
go run .
```

You should see:
```
‚úÖ Database connected successfully
```

## üìä Database Schema

### trading_signals Table

| Column | Type | Description |
|--------|------|-------------|
| id | UUID | Unique identifier |
| created_at | TIMESTAMP | When signal was created |
| symbol | VARCHAR | Trading pair (e.g., BTCUSDT) |
| strategy | VARCHAR | Strategy name |
| signal_type | VARCHAR | 'BUY' or 'SELL' |
| entry_price | DECIMAL | Entry price |
| stop_loss | DECIMAL | Stop loss price |
| take_profit | DECIMAL | Take profit price |
| current_price | DECIMAL | Current market price |
| risk_reward | DECIMAL | Risk/reward ratio |
| profit_loss | DECIMAL | Profit or loss amount |
| profit_loss_percent | DECIMAL | Profit or loss percentage |
| status | VARCHAR | ACTIVE, HIT_TP, HIT_SL, CLOSED |
| result | VARCHAR | Trade result description |
| progress | DECIMAL | Progress towards target (0-100%) |
| signal_time | TIMESTAMP | When signal was generated |
| closed_at | TIMESTAMP | When trade closed |

### Views

**signal_performance**: Aggregated performance metrics by strategy
**recent_signals**: Last 100 signals for quick access

## üîå API Endpoints

### Get Recent Signals
```
GET /api/v1/signal-storage/recent?limit=50
```

Response:
```json
{
  "success": true,
  "count": 50,
  "signals": [...]
}
```

### Get Performance Metrics
```
GET /api/v1/signal-storage/performance
```

Response:
```json
{
  "success": true,
  "performance": [
    {
      "strategy": "session_trader",
      "signal_type": "BUY",
      "total_signals": 100,
      "hit_tp_count": 45,
      "hit_sl_count": 30,
      "win_rate": 60.00
    }
  ]
}
```

### Update Signal Status
```
POST /api/v1/signal-storage/update
Content-Type: application/json

{
  "signal_id": "uuid-here",
  "status": "HIT_TP",
  "current_price": 43500.00,
  "profit_loss": 250.00,
  "profit_loss_percent": 2.5
}
```

## üìà Features

### Automatic Storage
- Every signal sent to Telegram is automatically saved
- No manual intervention required
- Runs 24/7 in background

### Performance Tracking
- Win rate by strategy
- Average profit/loss
- Risk/reward analysis
- Signal success rate

### Historical Data
- All signals stored permanently
- Query by date range
- Filter by strategy or symbol
- Export capabilities

## üîç Viewing Your Data

### In Supabase Dashboard

1. Go to "Table Editor" in left sidebar
2. Click "trading_signals" table
3. View all your signals
4. Filter, sort, and search
5. Export to CSV

### Query Examples

**Get all BUY signals:**
```sql
SELECT * FROM trading_signals 
WHERE signal_type = 'BUY' 
ORDER BY created_at DESC;
```

**Get winning trades:**
```sql
SELECT * FROM trading_signals 
WHERE status = 'HIT_TP';
```

**Calculate win rate:**
```sql
SELECT * FROM signal_performance;
```

## üõ°Ô∏è Security

### Row Level Security (RLS)

For production, enable RLS:

```sql
-- Enable RLS
ALTER TABLE trading_signals ENABLE ROW LEVEL SECURITY;

-- Create policy for authenticated users
CREATE POLICY "Enable read access for authenticated users" 
ON trading_signals FOR SELECT 
USING (auth.role() = 'authenticated');

CREATE POLICY "Enable insert for authenticated users" 
ON trading_signals FOR INSERT 
WITH CHECK (auth.role() = 'authenticated');
```

### API Key Security

- Never commit `.env` file to git
- Use environment variables in production
- Rotate keys if compromised
- Use service role key for backend only

## üìä Monitoring

### Check Signal Count
```sql
SELECT COUNT(*) FROM trading_signals;
```

### Today's Signals
```sql
SELECT COUNT(*) FROM trading_signals 
WHERE DATE(created_at) = CURRENT_DATE;
```

### Performance Summary
```sql
SELECT 
    strategy,
    COUNT(*) as total,
    AVG(CASE WHEN status = 'HIT_TP' THEN 1 ELSE 0 END) * 100 as win_rate
FROM trading_signals
GROUP BY strategy;
```

## üîß Troubleshooting

### "Supabase not configured"
- Check `.env` file has correct values
- Restart backend server
- Verify credentials in Supabase dashboard

### "Failed to save signal"
- Check internet connection
- Verify Supabase project is active
- Check API key permissions
- Review backend logs for details

### No data appearing
- Verify schema was created successfully
- Check if signals are being generated
- Look at backend logs for errors
- Test with manual API call

## üí° Tips

1. **Free Tier Limits**: 500MB database, 2GB bandwidth/month
2. **Upgrade if needed**: $25/month for Pro plan
3. **Backup**: Supabase handles automatic backups
4. **Performance**: Indexes already created for fast queries
5. **Scaling**: Can handle thousands of signals easily

## üéâ Benefits

- ‚úÖ Permanent signal history
- ‚úÖ Performance analytics
- ‚úÖ Win rate tracking
- ‚úÖ Strategy comparison
- ‚úÖ Export capabilities
- ‚úÖ Real-time updates
- ‚úÖ Automatic backups
- ‚úÖ Free tier available

---

**Status**: Ready to use
**Last Updated**: December 3, 2024
**Version**: 1.0.0
