ðŸ—„ï¸ SUPABASE DATABASE SETUP GUIDE

=== DO YOU NEED SUPABASE? ===

NO - The system works without Supabase!
- All backtesting features work
- AI optimization works
- Strategies work
- No database needed for core features

YES - If you want data persistence:
- Save user settings
- Store signal history
- Track performance over time
- Persist paper trading results


=== WHAT IS SUPABASE? ===

Supabase is a FREE PostgreSQL database with:
- REST API (easy to use)
- Real-time subscriptions
- Authentication
- Storage
- Free tier: 500MB database, 2GB bandwidth/month


=== SETUP STEPS ===

Step 1: Create Supabase Account
1. Go to https://supabase.com
2. Click "Start your project"
3. Sign up (free)
4. Create new project
5. Choose region (closest to you)
6. Set database password (save it!)
7. Wait 2-3 minutes for setup

Step 2: Get API Credentials
1. Go to Project Settings
2. Click "API" in sidebar
3. Copy these values:
   - Project URL (e.g., https://abc123.supabase.co)
   - anon/public key (starts with eyJ...)

Step 3: Configure Environment
```bash
# Copy template
cp .env.example .env

# Edit .env
nano .env

# Add your credentials:
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=eyJ...your-anon-key...
```

Step 4: Create Tables
Option A: Using SQL Editor (Recommended)
1. Go to Supabase Dashboard
2. Click "SQL Editor"
3. Click "New query"
4. Copy and paste from database_setup.sql
5. Click "Run"

Option B: Using psql
```bash
psql -h db.your-project.supabase.co \
     -U postgres \
     -d postgres \
     -f database_setup.sql
```

Step 5: Test Connection
```bash
./test_supabase.sh
```


=== TABLES NEEDED ===

1. user_settings
   - Stores filter preferences
   - Min confluence, risk percent
   - Enabled strategies
   
2. signals
   - Stores generated signals
   - Entry, stop loss, targets
   - Timestamp, status
   
3. paper_trades (optional)
   - Paper trading history
   - Performance tracking


=== TESTING ===

Test 1: Check Connection
```bash
./test_supabase.sh
```

Test 2: Manual API Test
```bash
# Replace with your credentials
SUPABASE_URL="https://your-project.supabase.co"
SUPABASE_KEY="your-anon-key"

# Test connection
curl -H "apikey: $SUPABASE_KEY" \
     -H "Authorization: Bearer $SUPABASE_KEY" \
     "$SUPABASE_URL/rest/v1/"
```

Test 3: Backend Integration
```bash
# Start backend
cd backend && go run .

# Test settings endpoint
curl http://localhost:8080/api/v1/settings
```


=== TROUBLESHOOTING ===

Error: "relation does not exist"
Solution: Tables not created. Run database_setup.sql

Error: "Invalid API key"
Solution: Check SUPABASE_KEY in .env

Error: "Could not connect"
Solution: Check SUPABASE_URL in .env

Error: "Permission denied"
Solution: Check Row Level Security (RLS) policies


=== FEATURES USING SUPABASE ===

With Supabase:
âœ“ User settings persistence
âœ“ Signal history storage
âœ“ Performance tracking
âœ“ Paper trading history
âœ“ Analytics over time

Without Supabase:
âœ“ All backtesting works
âœ“ AI optimization works
âœ“ Strategies work
âœ“ Live signals work
âœ“ Settings use defaults


=== COST ===

Free Tier (Sufficient for most users):
- 500MB database
- 2GB bandwidth/month
- Unlimited API requests
- 50,000 monthly active users

Paid Plans (if you need more):
- Pro: $25/month (8GB database, 50GB bandwidth)
- Team: $599/month (unlimited)


=== SECURITY ===

Best Practices:
1. Never commit .env to Git
2. Use anon key (not service_role key)
3. Enable Row Level Security (RLS)
4. Rotate keys periodically
5. Use environment variables


=== ALTERNATIVE: NO DATABASE ===

You can run the system WITHOUT Supabase:
- Settings use defaults
- Signals not persisted
- Everything else works

To disable Supabase warnings:
- Don't set SUPABASE_URL in .env
- System will use in-memory defaults


=== ROW LEVEL SECURITY (RLS) ===

For production, enable RLS:

```sql
-- Enable RLS
ALTER TABLE user_settings ENABLE ROW LEVEL SECURITY;
ALTER TABLE signals ENABLE ROW LEVEL SECURITY;

-- Allow public read
CREATE POLICY "Allow public read" ON user_settings
  FOR SELECT USING (true);

-- Allow public write
CREATE POLICY "Allow public write" ON user_settings
  FOR ALL USING (true);

-- Same for signals
CREATE POLICY "Allow public read" ON signals
  FOR SELECT USING (true);

CREATE POLICY "Allow public write" ON signals
  FOR ALL USING (true);
```


=== BACKUP ===

Automatic Backups (Free tier):
- Daily backups (7 days retention)
- Point-in-time recovery

Manual Backup:
```bash
pg_dump -h db.your-project.supabase.co \
        -U postgres \
        -d postgres \
        > backup.sql
```


=== MONITORING ===

Check Database Usage:
1. Go to Supabase Dashboard
2. Click "Database"
3. View:
   - Storage used
   - Bandwidth used
   - Active connections


=== MIGRATION ===

If you want to migrate to another database:
1. Export data: pg_dump
2. Update connection string in .env
3. Import data: psql < backup.sql


=== EXAMPLE .env ===

```bash
# Supabase Configuration
SUPABASE_URL=https://abcdefghijklmnop.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Alternative: Direct PostgreSQL
# SUPABASE_HOST=db.abcdefghijklmnop.supabase.co
# SUPABASE_PASSWORD=your-secure-password
```


=== QUICK START ===

Fastest way to get started:

1. Create Supabase account (2 minutes)
   https://supabase.com

2. Get credentials (1 minute)
   Project Settings > API

3. Configure .env (1 minute)
   cp .env.example .env
   # Add SUPABASE_URL and SUPABASE_KEY

4. Create tables (2 minutes)
   SQL Editor > Run database_setup.sql

5. Test (1 minute)
   ./test_supabase.sh

Total: 7 minutes to full setup!


=== SUPPORT ===

Supabase Documentation:
https://supabase.com/docs

Supabase Discord:
https://discord.supabase.com

Your System Documentation:
- database_setup.sql (table schemas)
- test_supabase.sh (connection test)
- .env.example (configuration template)


=== BOTTOM LINE ===

Supabase is OPTIONAL:
- System works great without it
- Add it for data persistence
- Free tier is generous
- Easy to setup (7 minutes)
- Can add anytime

Recommendation:
- Start WITHOUT Supabase
- Learn the system
- Add Supabase later if you want persistence

Your choice! Both options work perfectly! ðŸš€
