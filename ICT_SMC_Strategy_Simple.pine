//@version=5
strategy("ICT/SMC Simple v2.0", overlay=true, initial_capital=500, default_qty_type=strategy.percent_of_equity, default_qty_value=100, commission_type=strategy.commission.percent, commission_value=0.1, calc_on_every_tick=false)

// ═══════════════════════════════════════════════════════════════════
//  SIMPLIFIED ICT/SMC STRATEGY - OPTIMIZED FOR PROFITABILITY
//  Focus on high-quality setups only
// ═══════════════════════════════════════════════════════════════════

// INPUTS
useTrailingStop = input.bool(true, "Use Trailing Stop", group="Risk Management")
riskRewardRatio = input.float(3.0, "Risk:Reward Ratio", minval=1.0, step=0.5, group="Risk Management")
atrPeriod = input.int(14, "ATR Period", minval=1, group="Technical")
atrMultiplier = input.float(1.5, "ATR Stop Loss Multiplier", minval=0.5, step=0.1, group="Technical")

// TECHNICAL INDICATORS
atr = ta.atr(atrPeriod)
ema20 = ta.ema(close, 20)
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)
rsi = ta.rsi(close, 14)

// VOLUME
avgVol = ta.sma(volume, 20)
volRatio = volume / avgVol

// TREND DETECTION
strongUptrend = close > ema20 and ema20 > ema50 and ema50 > ema200 and close > ema200
strongDowntrend = close < ema20 and ema20 < ema50 and ema50 < ema200 and close < ema200

// MOMENTUM
momentum = ta.change(close, 10)
bullishMomentum = momentum > 0 and close > close[5]
bearishMomentum = momentum < 0 and close < close[5]

// ORDER BLOCK DETECTION (Simplified)
bullishOB = close[1] < open[1] and close > open and (close - open) > (open[1] - close[1]) * 1.5
bearishOB = close[1] > open[1] and close < open and (open - close) > (close[1] - open[1]) * 1.5

// LIQUIDITY SWEEP
swingLow = ta.lowest(low, 20)
swingHigh = ta.highest(high, 20)
bullishSweep = low < swingLow[5] and close > open
bearishSweep = high > swingHigh[5] and close < open

// CONFLUENCE SCORING
bullishScore = 0
bearishScore = 0

// Score bullish conditions
if strongUptrend
    bullishScore += 3
if bullishMomentum
    bullishScore += 2
if rsi < 60 and rsi > 40
    bullishScore += 2
if volRatio > 1.2
    bullishScore += 2
if bullishOB
    bullishScore += 3
if bullishSweep
    bullishScore += 2
if close > ema20
    bullishScore += 1

// Score bearish conditions
if strongDowntrend
    bearishScore += 3
if bearishMomentum
    bearishScore += 2
if rsi > 40 and rsi < 60
    bearishScore += 2
if volRatio > 1.2
    bearishScore += 2
if bearishOB
    bearishScore += 3
if bearishSweep
    bearishScore += 2
if close < ema20
    bearishScore += 1

// ENTRY SIGNALS (High threshold for quality)
longSignal = bullishScore >= 8 and strongUptrend and volRatio > 1.0
shortSignal = bearishScore >= 8 and strongDowntrend and volRatio > 1.0

// POSITION MANAGEMENT
var float entryPrice = na
var float stopLoss = na
var float takeProfit = na

// LONG ENTRY
if longSignal and strategy.position_size == 0
    entryPrice := close
    stopLoss := close - (atr * atrMultiplier)
    takeProfit := close + (atr * atrMultiplier * riskRewardRatio)
    strategy.entry("LONG", strategy.long)
    strategy.exit("EXIT LONG", "LONG", stop=stopLoss, limit=takeProfit)

// SHORT ENTRY
if shortSignal and strategy.position_size == 0
    entryPrice := close
    stopLoss := close + (atr * atrMultiplier)
    takeProfit := close - (atr * atrMultiplier * riskRewardRatio)
    strategy.entry("SHORT", strategy.short)
    strategy.exit("EXIT SHORT", "SHORT", stop=stopLoss, limit=takeProfit)

// TRAILING STOP
if useTrailingStop and strategy.position_size > 0
    trailStop = close - (atr * atrMultiplier)
    strategy.exit("TRAIL LONG", "LONG", stop=trailStop)

if useTrailingStop and strategy.position_size < 0
    trailStop = close + (atr * atrMultiplier)
    strategy.exit("TRAIL SHORT", "SHORT", stop=trailStop)

// VISUALIZATION
plot(ema20, "EMA 20", color=color.blue, linewidth=2)
plot(ema50, "EMA 50", color=color.orange, linewidth=2)
plot(ema200, "EMA 200", color=color.red, linewidth=2)

plotshape(longSignal, "Long", shape.triangleup, location.belowbar, color.new(color.green, 0), size=size.small)
plotshape(shortSignal, "Short", shape.triangledown, location.abovebar, color.new(color.red, 0), size=size.small)

// DASHBOARD
var table dashboard = table.new(position.top_right, 2, 6, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast
    table.clear(dashboard, 0, 0, 1, 5)
    
    table.cell(dashboard, 0, 0, "ICT/SMC Simple", text_color=color.white, text_size=size.normal, bgcolor=color.new(color.blue, 50))
    table.cell(dashboard, 1, 0, "Status", text_color=color.white, text_size=size.normal, bgcolor=color.new(color.blue, 50))
    
    table.cell(dashboard, 0, 1, "Bull Score", text_color=color.gray, text_size=size.small)
    table.cell(dashboard, 1, 1, str.tostring(bullishScore) + "/15", text_color=color.white, text_size=size.small)
    
    table.cell(dashboard, 0, 2, "Bear Score", text_color=color.gray, text_size=size.small)
    table.cell(dashboard, 1, 2, str.tostring(bearishScore) + "/15", text_color=color.white, text_size=size.small)
    
    table.cell(dashboard, 0, 3, "Trend", text_color=color.gray, text_size=size.small)
    trendText = strongUptrend ? "STRONG UP" : strongDowntrend ? "STRONG DOWN" : "NEUTRAL"
    trendColor = strongUptrend ? color.green : strongDowntrend ? color.red : color.gray
    table.cell(dashboard, 1, 3, trendText, text_color=trendColor, text_size=size.small)
    
    table.cell(dashboard, 0, 4, "Volume", text_color=color.gray, text_size=size.small)
    table.cell(dashboard, 1, 4, str.tostring(math.round(volRatio * 100)) + "%", text_color=volRatio > 1.2 ? color.green : color.gray, text_size=size.small)
    
    table.cell(dashboard, 0, 5, "Signal", text_color=color.gray, text_size=size.small)
    signalText = longSignal ? "LONG" : shortSignal ? "SHORT" : "WAIT"
    signalColor = longSignal ? color.green : shortSignal ? color.red : color.gray
    table.cell(dashboard, 1, 5, signalText, text_color=signalColor, text_size=size.normal)

// ALERTS
alertcondition(longSignal, "Long Signal", "ICT/SMC Long Entry")
alertcondition(shortSignal, "Short Signal", "ICT/SMC Short Entry")
